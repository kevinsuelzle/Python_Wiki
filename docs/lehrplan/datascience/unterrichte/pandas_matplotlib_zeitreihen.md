# Thema: Zeitreihenanalyse mit Pandas und Matplotib 

## Einf√ºhrung [10 min]

Zeitreihenanalysen spielen in vielen Anwendungsbereichen eine zentrale Rolle. Sie erm√∂glichen es, Muster, Trends und saisonale Schwankungen in Datens√§tzen √ºber Zeit zu erkennen und zu analysieren. Die Bibliotheken Pandas und Matplotlib in Python sind dabei unverzichtbare Werkzeuge. Pandas bietet effiziente und intuitive Methoden zur Manipulation und Analyse von Zeitreihendaten, w√§hrend Matplotlib leistungsstarke Visualisierungsfunktionen bietet.

## Grundlagen von Zeitreihen

Eine Zeitreihe ist eine Sequenz von Datenpunkten, die in zeitlicher Reihenfolge erfasst werden. Typische Beispiele sind Aktienkurse, Wetterdaten, Verkaufszahlen oder Sensordaten einer Maschine. Zeitreihen sind besonders wertvoll, weil sie es erm√∂glichen, nicht nur den aktuellen Zustand, sondern auch die Entwicklung √ºber Zeit zu verstehen. Dies ist entscheidend f√ºr Prognosen, Trendanalysen und sogar f√ºr das Erkennen von Anomalien.

## Anwendungen in der Praxis

- Finanzmarktanalyse: Im Finanzbereich sind Zeitreihen unverzichtbar, um Markttrends zu verstehen und Vorhersagen zu treffen. Aktienkurse und W√§hrungswerte, die √ºber Zeit aufgezeichnet werden, helfen Analysten, Marktverhalten zu interpretieren und informierte Investitionsentscheidungen zu treffen.

- Wettervorhersage: Meteorologen verwenden Zeitreihen, um Wetterver√§nderungen zu analysieren und Vorhersagen zu treffen. Durch die Analyse historischer Wetterdaten k√∂nnen Muster und Trends identifiziert werden, die f√ºr zuk√ºnftige Prognosen n√ºtzlich sind.

- Verkaufs- und Marketinganalyse: Unternehmen nutzen Zeitreihendaten, um Verkaufstrends zu verstehen und Marketingstrategien anzupassen. Die Analyse saisonaler Muster in Verkaufsdaten hilft bei der Planung von Werbekampagnen und Lagerbest√§nden.

- Maschinenwartung: Viele Maschinen besitzen heute Sensoren wie Temperatur, Druck, Durchflussgeschwindigkeit, Drehmomente, etc. Diese werden oft mit hohen Abtastfrequnzen geliefert, so dass pro Minute Maschinenbetrieb riesige Mengen Zeitreihen zur Verf√ºgung stehen. Diese k√∂nnen dann genutzt werden, um Modelle des Maschinenverhaltens zu erlernen, die wiederum zum Beispiel Vorhersagen erm√∂glichen k√∂nnen, Maschinenausf√§lle vorherzusagen.

## Bedeutung von Pandas und Matplotlib bei der Zeitreihenverarbeitung

Pandas ist besonders n√ºtzlich f√ºr die Handhabung und Analyse von Zeitreihendaten, da es Funktionen bietet, um Datums- und Zeitstempel effizient zu verarbeiten. Es erleichtert das Gruppieren, Filtern und Aggregieren von Daten basierend auf Zeitintervallen. Matplotlib erg√§nzt Pandas, indem es erm√∂glicht, die Ergebnisse der Zeitreihenanalyse visuell darzustellen. Graphen und Charts helfen dabei, Trends und Muster schnell zu erkennen und zu kommunizieren.

Die Arbeit mit Zeitreihen in Pandas und Matplotlib hat einen hohen Praxisbezug in vielen Bereichen, von der Finanzanalyse √ºber die Meteorologie, Marketing und die Maschinenwartung. Diese Werkzeuge bieten eine leistungsstarke Kombination aus Analyse- und Visualisierungsfunktionen, die es erm√∂glichen, wertvolle Einblicke aus Zeitreihendaten zu gewinnen und fundierte Entscheidungen zu treffen.

## Codebeispiele [50 min]

### Beispiel 1: Daten in eine Zeitreihe mit Datum als Index umwandeln


```python
import pandas as pd

# Beispiel-Datensatz
data = {'Datum': ['2023-01-01', '2023-01-02', '2023-01-03', '2023-01-04', '2023-01-05'],
        'Wert': [100, 200, 300, 250, 290]}
df = pd.DataFrame(data)

# Umwandlung der 'Datum'-Spalte in ein Datumsformat
df['Datum'] = pd.to_datetime(df['Datum'])

# Setzen der 'Datum'-Spalte als Index
df.set_index('Datum', inplace=True)

print(df)
```

                Wert
    Datum           
    2023-01-01   100
    2023-01-02   200
    2023-01-03   300
    2023-01-04   250
    2023-01-05   290


In diesem Beispiel wird zuerst ein Pandas DataFrame df mit einer Spalte f√ºr Daten ('Datum') und einer Spalte f√ºr Werte ('Wert') erstellt. Anschlie√üend wird die 'Datum'-Spalte in ein Python Datumsformat umgewandelt, damit Pandas sie als Zeitreihe behandeln kann. Schlie√ülich wird diese Spalte als Index des DataFrames gesetzt, was eine wichtige Voraussetzung f√ºr die meisten Zeitreihenoperationen ist.

### Beispiel 2: Zeitreihendaten gl√§tten


```python
import matplotlib.pyplot as plt
import numpy as np

N = 200
x = [0]
for i in range(N-1):
    x.append( x[-1] + np.random.randint(-20,21) )

# Erzeugen einer einfachen Zeitreihe
ts = pd.Series(x, 
               index=pd.date_range(start='2023-01-01', periods=N))

# Gl√§tten der Daten mit einem gleitenden Durchschnitt
smoothed_ts = ts.rolling(window=5).mean()

print(ts.head(10))
print(smoothed_ts.head(10))

# Plotten der Original- und gegl√§tteten Zeitreihe
plt.plot(ts, label='Original')
plt.plot(smoothed_ts, label='Gegl√§ttet')
plt.legend()
plt.show()
```

    2023-01-01     0
    2023-01-02    19
    2023-01-03     4
    2023-01-04    17
    2023-01-05     3
    2023-01-06    12
    2023-01-07    -7
    2023-01-08   -20
    2023-01-09   -25
    2023-01-10   -16
    Freq: D, dtype: int64
    2023-01-01     NaN
    2023-01-02     NaN
    2023-01-03     NaN
    2023-01-04     NaN
    2023-01-05     8.6
    2023-01-06    11.0
    2023-01-07     5.8
    2023-01-08     1.0
    2023-01-09    -7.4
    2023-01-10   -11.2
    Freq: D, dtype: float64



    
![png](pandas_matplotlib_zeitreihen_files/pandas_matplotlib_zeitreihen_7_1.png)
    


In diesem Beispiel wird eine einfache Zeitreihe ts mit zuf√§lligen Werten erzeugt. Die Zeitreihe wird dann mit der Methode rolling() gegl√§ttet, die einen gleitenden Durchschnitt berechnet (hier √ºber ein Fenster von 5 Tagen). Die Original- und die gegl√§ttete Zeitreihe werden anschlie√üend mit Matplotlib geplottet, um den Gl√§ttungseffekt zu visualisieren.

### Beispiel 3: Zeitreihendaten auf eine bestimmte Periode resampling


```python
# Resampling der Zeitreihe auf w√∂chentliche Daten
weekly_ts = ts.resample('W').mean()
print(weekly_ts.head(10))

# Plotten der w√∂chentlich aggregierten Zeitreihe
plt.plot(weekly_ts)
plt.title('W√∂chentliche Durchschnitte')
plt.show()
```

    2023-01-01      0.000000
    2023-01-08      4.000000
    2023-01-15     -4.714286
    2023-01-22    -18.428571
    2023-01-29    -36.285714
    2023-02-05    -45.142857
    2023-02-12    -57.428571
    2023-02-19   -127.571429
    2023-02-26   -148.571429
    2023-03-05   -129.285714
    Freq: W-SUN, dtype: float64



    
![png](pandas_matplotlib_zeitreihen_files/pandas_matplotlib_zeitreihen_10_1.png)
    


In diesem Beispiel wird die zuvor erstellte Zeitreihe ts auf eine w√∂chentliche Frequenz umgerechnet, indem das resample()-Verfahren verwendet wird. F√ºr jede Woche wird der Durchschnitt der Werte berechnet. Das Ergebnis wird dann als Linienplot dargestellt, um die w√∂chentlichen Durchschnittswerte zu visualisieren.

### Beispiel 4: Zeitreihe auf Trend und Saisonalit√§t untersuchen

Installieren Sie jetzt zuerst das Paket statsmodels mit:

    pip install statsmodels

In einer Jupyter-Notebook-Codezelle k√∂nnen Sie dies mit

    !pip install statsmodels

tun.


```python
from statsmodels.tsa.seasonal import seasonal_decompose

df = pd.read_csv("https://raw.githubusercontent.com/jbrownlee/Datasets/master/airline-passengers.csv")
print(df.head())

passengers = df["Passengers"]

# Annahme: ts hat eine t√§gliche Frequenz
result = seasonal_decompose(passengers, model='additive', period=12)

# Plotten der Komponenten
result.plot()
plt.show()
```

         Month  Passengers
    0  1949-01         112
    1  1949-02         118
    2  1949-03         132
    3  1949-04         129
    4  1949-05         121



    
![png](pandas_matplotlib_zeitreihen_files/pandas_matplotlib_zeitreihen_14_1.png)
    


Hier wird die Bibliothek statsmodels verwendet, um eine Zeitreihe in ihre Komponenten zu zerlegen: Trend, Saisonalit√§t und Restkomponente. Dies geschieht mit der Funktion seasonal_decompose, wobei angenommen wird, dass die Zeitreihe eine monatliche Frequenz hat und die Saisonalit√§t auf einer j√§hrlichen Basis (Periodenl√§nge 12 Monate) auftritt. Das Ergebnis wird in separaten Plots dargestellt, um die verschiedenen Komponenten der Zeitreihe zu visualisieren.

### Beispiel 5: Zeitreihen-Daten anhand von Monatsdurchschnitten aggregieren


```python
# Erzeugen einer Zeitreihe mit t√§glichen Daten √ºber ein Jahr
np.random.seed(0)
daily_data = np.random.randn(365) + 10  # Zuf√§llige Daten um den Mittelwert 10
dates = pd.date_range(start='2023-01-01', periods=365, freq='D')
daily_ts = pd.Series(daily_data, index=dates)

plt.plot(daily_ts)
plt.show()

# Monatsdurchschnitte berechnen
monthly_avg = daily_ts.resample('M').mean()

# Plotten der monatlichen Durchschnittswerte
plt.figure(figsize=(10, 6))
monthly_avg.plot(kind='bar')
plt.title('Monatliche Durchschnittswerte')
plt.xlabel('Monat')
plt.ylabel('Durchschnittswert')
plt.show()
```


    
![png](pandas_matplotlib_zeitreihen_files/pandas_matplotlib_zeitreihen_17_0.png)
    



    
![png](pandas_matplotlib_zeitreihen_files/pandas_matplotlib_zeitreihen_17_1.png)
    


In diesem Beispiel wird zun√§chst eine Zeitreihe mit zuf√§lligen t√§glichen Werten √ºber ein Jahr erstellt. Diese Werte sind um den Mittelwert 10 zentriert. Die Zeitreihe wird dann auf Monatsbasis neu gruppiert, indem die Methode resample('M') verwendet wird, und f√ºr jeden Monat wird der Durchschnittswert berechnet. Diese monatlichen Durchschnittswerte werden als Balkendiagramm dargestellt, um die Ver√§nderungen √ºber die Monate hinweg zu visualisieren. Dies ist besonders n√ºtzlich, um saisonale Trends oder langfristige Ver√§nderungen in den Daten zu erkennen.

## Aufgaben [150 min]

### A1: Zeitreihendatensatz erstellen üå∂Ô∏èüå∂Ô∏è

Erstellen Sie eine Pandas Zeitreihe aus einem Datensatz mit t√§glichen Daten f√ºr ein Jahr. Verwenden Sie dabei zuf√§llige Werte.
Zudem soll es einen linearen Trend geben.

### A2: Zeitreihe visualisieren üå∂Ô∏è

Visualisieren Sie die erstellte Zeitreihe aus Aufgabe 1 mit Matplotlib.

### A3: Gleitenden Durchschnitt berechnen üå∂Ô∏èüå∂Ô∏è

Berechnen Sie den gleitenden Durchschnitt √ºber 7 Tage f√ºr die Zeitreihe aus Aufgabe 1 und plotten Sie das Ergebnis.

### A4: Zeitreihe auf Monatsbasis aggregieren üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è

Aggregieren Sie die Daten aus Aufgabe 1 auf Monatsbasis und visualisieren Sie die monatlichen Durchschnittswerte.

### A5: Zeitreihen-Daten normalisieren üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è

Normalisieren Sie die Werte der ersten Zeitreihe aus Aufgabe 1, so dass sie zwischen 0 und 1 liegen, und visualisieren Sie das Ergebnis.

### A6: Zeitreihe mit saisonalem Muster üå∂Ô∏èüå∂Ô∏è

Erstellen Sie eine Zeitreihe mit einem klaren saisonalen Muster und visualisieren Sie diese.

### A7: Zeitreihen mit Seaborn als Heatmap visualisieren üå∂Ô∏èüå∂Ô∏è

Verwenden Sie Seaborn, um eine Heatmap der monatlichen Daten aus Aufgabe 4 zu erstellen.

In dieser Aufgabe wird die urspr√ºngliche Zeitreihe auf eine zweidimensionale Form umstrukturiert, um eine Heatmap zu erstellen. Dabei wird jeder Monat gegen jeden Tag im Monat abgebildet. Seaborn's heatmap-Funktion wird verwendet, um die Daten zu visualisieren, wobei unterschiedliche Farben die Intensit√§t der Werte an jedem Tag anzeigen.

### A8: Zuk√ºnftige Werte einer Zeitreihe prognostizieren üå∂Ô∏èüå∂Ô∏èüå∂Ô∏èüå∂Ô∏è

Verwenden Sie eine einfache lineare Regression aus scikit-learn, um die n√§chsten 30 Tage der Zeitreihe aus Aufgabe 1 zu prognostizieren.

Falls Sie scikit-learn noch nicht installiert haben, k√∂nnen Sie dies mit

    pip install scikit-learn

### A9: Zeitreihen-Daten in Perioden unterteilen und vergleichen üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è

Unterteilen Sie die Zeitreihe aus Aufgabe 1 in zwei gleiche Perioden und vergleichen Sie die statistischen Kennzahlen (Mittelwert, Median, Standardabweichung) dieser Perioden.

Die Zeitreihe wird in dieser Aufgabe in zwei gleich lange Perioden unterteilt. F√ºr jede Periode werden statistische Kennzahlen wie Mittelwert, Median und Standardabweichung berechnet. Diese Kennzahlen werden dann verglichen, um festzustellen, ob es signifikante Unterschiede zwischen den beiden Perioden gibt. Solche Analysen sind n√ºtzlich, um Ver√§nderungen im Zeitverlauf zu verstehen, die auf Trends, saisonale Einfl√ºsse oder andere Faktoren hindeuten k√∂nnten.

[L√∂sungen](pandas_matplotlib_zeitreihen_loesungen.md)


```python

```
